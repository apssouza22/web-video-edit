flowchart TB
    subgraph s1["studio/"]
        Studio["studio.ts<br>VideoStudio"]
        StudioInit["initilizer.ts"]
        StudioEvents["studio-event-handler.ts"]
        StudioControls["controls.ts"]
        ControlHandler["mediaclip-ops.ts"]
        MediaLoader["mediaclip-loader.ts"]
        AspectRatio["aspect-ratio-selector.ts"]
        SpeedControl["speed-control-input.ts"]
        LoadingPopup["loading-popup.ts"]
        Studio --> ControlHandler
        Studio --> DragHandler
        Studio --> AspectRatio
        Studio --> SpeedControl

    end
    subgraph s2["canvas/"]
        Canvas["canvas.ts<br>VideoCanvas"]
        CanvasLayer["canvas-layer.ts"]
        CanvasTypes["types.ts"]
        CanvasIndex["index.ts"]
    end
    subgraph s3["timeline/layers/"]
        AudioTL["audio-timeline-layer.ts"]
        VideoTL["video-timeline-layer.ts"]
        ImageTL["image-timeline-layer.ts"]
        TextTL["text-timeline-layer.ts"]
    end
    subgraph s4["timeline/"]
        Timeline["timeline.ts<br>TimelineService"]
        TLLayer["timeline-layer.ts"]
        TLFactory["timeline-layer-factory.ts"]
        TLRender["tllayer-render.ts"]
        TLDrag["drag.ts"]
        TLZoom["zoom.ts"]
        TimeMarker["time-marker.ts"]
        LayerReorder["layer-reorder-handler.ts"]
        TLTypes["types.ts"]
        s3
        Timeline --> TLRender
        Timeline --> TLPreview
        Timeline --> TLZoom
        Timeline --> LayerReorder
        Timeline --> TLDrag
        Timeline --> TimeMarker
    end
    subgraph s5["mediaclip/"]
        MediaService["mediaclip-service.ts"]
        MediaCommon["mediaclip-common.ts<br>AbstractMedia"]
        MediaVideo["video.ts<br>VideoMedia"]
        MediaAudio["audio.ts<br>AudioMedia"]
        MediaImage["image.ts<br>ImageMedia"]
        MediaText["text.ts<br>TextMedia"]
        MediaTypes["types.ts"]
        SpeedController["speed-controller.ts"]
        MediaIndex["index.ts"]
        VideoLoader["video-loader.ts"]
        AudioSource["audio-source.ts"]
    end
    subgraph s6["htmldemuxer/"]
        HTMLDemux["html-video-demuxer.ts"]
        FrameQuality["frame-quality.ts"]
    end
    subgraph s7["mp4boxdemuxer/"]
        CodecDemux["codec-demuxer.js"]
        MP4Worker["worker.js"]
        VideoDecoder["video-decoder.js"]
        AudioDecoder["audio-decoder.js"]
    end
    subgraph s8["video/demux/"]
        VideoDemux["video-demux.ts<br>VideoDemuxService"]
        MediaBunnyDemux["mediabunny-demuxer.ts"]
        DemuxIndex["index.ts"]
        s6
        s7
    end
    subgraph s9["video/muxer/"]
        VideoExport["video-export-service.ts"]
        MediaRecorderExp["mediaclip-recorder-exporter.ts"]
        WebCodecExp["web-codec-exporter.ts"]
        MuxerIndex["index.ts"]
    end
    subgraph s10["video/"]
        s8
        s9
    end
    subgraph s11["audio/"]
        AudioCutter["audio-cutter.ts"]
        AudioSplit["AudioSplitHandler.ts"]
        PitchProcessor["pitch-preservation-processor.ts"]
    end
    subgraph s12["recording/"]
        RecordService["service.ts<br>UserMediaRecordingService"]
        RecordControls["controls.ts"]

        RecordIndex["index.ts"]
    end
    subgraph s13["transcription/"]
        Transcription["transcription.ts<br>TranscriptionService"]
        TranscriptionView["transcription-view.ts"]
        TranscriptionModel["model-factory.ts"]
        TranscriptionWorker["worker.ts"]
        TranscriptionTypes["types.ts"]
        TranscriptionIndex["index.ts"]
    end
    subgraph s14["frame/"]
        FrameService["frames.ts<br>FrameService"]
        Frame["frame.ts"]
        FrameAdjust["frame-adjust.ts"]
        FrameTypes["types.ts"]
        FrameIndex["index.ts"]
        FrameService --> FrameAdjust
    end
    subgraph s16["common/"]
        EventBus["event-bus.ts<br>EventBus"]
        StudioState["studio-state.ts<br>StudioState"]
        Utils["utils.ts"]
        BrowserSupport["browser-support.ts"]
        Render2D["render-2d.ts"]
        PinchHandler["pinch-handler.ts"]
        CommonIndex["index.ts"]
    end
    subgraph s17["src/"]
        Main["main.js/main.ts<br>Entry Point"]
        s1
        s2
        s4
        s5
        s10
        s11
        s12
        s13
        s14
        s16
    end
    AudioService --> AudioCutter & AudioSplit & PitchProcessor
    MediaAudio --> AudioSource
    MediaService --> SpeedController & MediaVideo & MediaAudio & MediaImage & MediaText & AudioService
    Main --> Studio
    Studio --> StudioInit & Canvas & Timeline & MediaService & MediaLoader & VideoExport & Transcription & RecordService
    StudioInit --> Studio & StudioEvents
    Canvas --> CanvasLayer
    Timeline --> TLLayer & TLFactory
    TLFactory --> AudioTL & VideoTL & ImageTL & TextTL
    MediaLoader --> VideoLoader & AudioLoader
    VideoLoader --> VideoDemux
    VideoDemux --> MediaBunnyDemux & HTMLDemux & CodecDemux
    VideoExport --> MediaRecorderExp & WebCodecExp
    RecordService --> RecordPreview
    Transcription --> TranscriptionModel & TranscriptionWorker
    Animation["animation.js"]
    AnimationIndex["index.js"]
    MediaService --> FrameService

    style Studio fill:#e1f5ff
    style Canvas fill:#d4edda
    style Timeline fill:#d4edda
    style MediaService fill:#fff3cd
    style VideoDemux fill:#f8d7da
    style VideoExport fill:#f8d7da
    style RecordService fill:#d1ecf1
    style Transcription fill:#e2d5f0
    style EventBus fill:#fff3cd
