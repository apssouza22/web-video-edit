flowchart LR
    subgraph subGraph0["User Interface Layer"]
        UI["HTML/CSS UI"]
        Controls["Studio Controls"]
        Timeline["Timeline Component"]
        Canvas["Video Canvas Display"]
    end
    subgraph subGraph1["Core Orchestration"]
        Studio["VideoStudio<br>Main Orchestrator"]
        EventBus["EventBus<br>Central Communication"]
        State["StudioState<br>Global State"]
    end
    subgraph subGraph2["Clip Management"]
        MediaService["MediaService<br>Clip Operations"]
        MediaLoader["MediaLoader<br>Clip Loading"]
        ClipLayers["Clip Layers<br>Video/Audio/Image/Text/Caption/Shape"]
        AudioLoader["Audio Loader"]
        AudioSource["Audio Source"]
    end
    subgraph subGraph3["Playback & Rendering"]
        Player["VideoCanvas<br>Player &amp; Renderer"]
        CanvasLayers["Canvas Layers<br>Layer Rendering"]
        AudioContext["Web Audio API"]
    end
    subgraph subGraph4["Timeline System"]
        TL["Timeline<br>Timeline Manager"]
        TLLayers["Timeline Layers<br>Visual Representation"]
        TimeMarker["Time Marker"]
        DragHandler["Drag & Drop Handler"]
        Cursor["Timeline Cursor<br>Cursor State"]
    end
    subgraph subGraph10["Settings System"]
        ClipSettings["ClipSettingsService<br>Property Management"]
        ClipSettingsView["ClipSettingsView<br>Settings UI"]
    end
    subgraph subGraph5["Video Processing"]
        Demux["VideoDemuxService<br>Frame Extraction"]
        MP4Box["MP4Box Demuxer"]
        MediaBunny["MediaBunny Demuxer"]
        HTMLDemux["HTML5 Video Demuxer"]
        FrameService["Frame Service"]
    end
    subgraph subGraph6["Export System"]
        Export["VideoExportService"]
        MediaRecorder["MediaRecorder Exporter"]
        WebCodec["WebCodec Exporter"]
    end
    subgraph subGraph7["Recording System"]
        Record["UserMediaRecordingService"]
        Preview["Recording Preview"]
        MediaStream["MediaStream API"]
    end
    subgraph subGraph8["AI Features"]
        Transcription["TranscriptionService"]
        AIModel["Transformers.js Model"]
    end
    subgraph subGraph9["Audio Processing"]
        AudioService["Audio Service"]
        AudioCutter["Audio Cutter"]
        PitchProcessor["Pitch Preservation"]
    end
    UI --> Studio
    Controls --> Studio
    Timeline --> Studio
    Canvas --> Player
    Studio --> EventBus & State & Player & TL & MediaService & Export & Transcription & Record & ClipSettings
    EventBus -.-> Player & TL & ClipLayers & Record & ClipSettings
    MediaService --> ClipLayers & AudioService
    MediaLoader --> ClipLayers & Demux & AudioLoader
    ClipLayers --> AudioSource
    AudioService --> AudioCutter & PitchProcessor
    Player --> CanvasLayers & AudioContext
    TL --> TLLayers & TimeMarker & DragHandler & Cursor
    Demux --> MP4Box & MediaBunny & HTMLDemux & FrameService
    Export --> MediaRecorder & WebCodec
    Record --> Preview & MediaStream
    Transcription --> AIModel
    ClipSettings --> ClipSettingsView & ClipLayers
    ClipSettingsView --> ClipSettings

    style Studio fill:#e1f5ff
    style EventBus fill:#fff3cd
    style Player fill:#d4edda
    style TL fill:#d4edda
    style Demux fill:#f8d7da
    style Export fill:#f8d7da
    style Record fill:#d1ecf1
    style Transcription fill:#e2d5f0
    style ClipSettings fill:#fff3cd